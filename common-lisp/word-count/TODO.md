- Firstly, you could redefine valid-char-p to make use of the nifty builtin: alphanumericp.
- Perhaps the most significant simplification would be to replace split-if-not with a function from UIOP, namely uiop:split-string. UIOP is a standard for interfacing with the operating system and contains some utility functions such as this one. It should be built-in to any modern common lisp environment. By default, it splits strings on spaces and tabs, but you can provide your own string of characters to split on.
- Those two tweaks should save you a ton of code and make things a bit easier to read. As a final side note, it's generally considered good practice to write things like #'trim-apostrophe instead of just 'trim-apostrophe this "sharp-quote" tells CL that you are writing the name of a function and it can perform some checks that the function exists and is callable. Additionally, it signals to the reader that what follows is a function and not just another magic symbol like 'list.
